# ============================================
# SPA
# ============================================
FROM nginx:alpine
RUN adduser -D -s /bin/sh appuser
COPY <<EOF /etc/nginx/nginx.conf
user appuser;
worker_processes 1;
events { worker_connections 1024; }
http {
    include /etc/nginx/mime.types;
    server_tokens off;
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    server {
        listen 8080;
        root /usr/share/nginx/html;
        index index.html;
        location / { try_files \$uri \$uri/ /index.html; }
        location ~ /\. { deny all; }
    }
}
EOF
COPY ./dist/ /usr/share/nginx/html/
RUN chown -R appuser:appuser /usr/share/nginx/html /var/cache/nginx /var/log/nginx /etc/nginx /var/run
USER appuser
EXPOSE 8080
CMD ["nginx", "-g", "daemon off;"]